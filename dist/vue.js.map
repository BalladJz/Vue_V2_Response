{"version":3,"file":"vue.js","sources":["../src/observer/dep.js","../src/observer/index.js","../src/observer/watcher.js","../src/index.js"],"sourcesContent":["// @ts-nocheck\n\nclass Dep {\n  constructor() {\n    this.subs = []\n  }\n  // 成员方法\n  addSubs(watcher) {\n    this.subs.push(watcher)\n    console.log('Dep类 addSubs => 添加依懒 了吗？', this.subs)\n  }\n  depend() {\n    if (Dep.target) {\n      this.addSubs(Dep.target)\n    }\n    console.log('Dep类 depend =>  收集依懒')\n  }\n  notify(newValue) {\n    //  深拷贝\n    const subs = this.subs.slice()\n    // 通知\n    subs.forEach((v) => v.update(newValue))\n    console.log('Dep类 depend =>  通知依懒')\n  }\n}\n\nexport { Dep }\n","import { Dep } from './dep.js'\n/** 定义observer 类 */\n\n/**\n * 实现响应式的方法\n * @param {*} obj 实现相应式的数据\n * @param {*} key 实现相应式的数据的属性\n * @param {*} val 相当于闭包的一个参数\n * @param {*} cb 数据更新调用的回调函数\n */\nfunction defineReactive(obj, key, val, cb) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {\n    get: () => {\n      console.log('defineReactive get => 获取数据', val)\n      //  收集依赖\n      dep.depend()\n\n      return val\n    },\n    set: (value) => {\n      console.log('defineReactive set => 更新数据', value)\n      val = value\n      // 通知依懒 (触发依懒的更新)\n      dep.notify(value) \n\n      cb ? cb(value) : null\n    },\n  })\n}\n\n/**\n *  通过类\n *  1、添加响应式标志\n *  2、实现响应式\n */\nclass Observer {\n  constructor(value, cb) {\n    //  给数据添加'__ob__'属性，且可以精确设置它能够被枚举，重写等\n    Object.defineProperty(value, '__ob__', {\n      // this表示 observe类 \n      value: this,\n      enumerable: false,\n    })\n    // 因为 Observer 与 Dep 是关联的 所以在实例化Observer是要 new一个Dep\n    const dep = new Dep()\n\n    // 调用类的方法成员，遍历数据 实现响应式\n    this.walk(value, cb)\n  }\n  walk(value, cb) {\n    Object.keys(value).forEach((key) => {\n      defineReactive(value, key, value[key], cb)\n    })\n  }\n}\n\n\n/**\n * 实现数据的响应式（双向绑定）\n * @param {*} value 传入需要实现响应式的数据\n * @param {*} cb 数据更新调用的回调函数\n * @returns\n */\nfunction observe(value, cb = undefined) {\n  // 声明一个ob 用来标记数据是否是响应式的\n  let ob\n  // 判断 如果数据有“__ob__”这个属性，则不添加\n  if (typeof value.__ob__ !== 'undefined') {\n    ob = value.__ob__\n  } else {\n    // 判断 如果数据没有“__ob__”这个属性，则添加上\n    ob = new Observer(value, cb)\n  }\n  return ob\n}\n\nexport { observe, Observer }\n","// @ts-nocheck\nimport { Dep } from './dep'\n\n/**\n * vue Vue的实例\n * exp 字符串\n * cb  回调\n */\nclass Watcher {\n  constructor(vue, exp, cb) {\n    // 绑定到 Watcher 类身上\n    this.vm = vue\n    this.exp = exp\n    this.cb = cb\n\n    // 在类上面添加一个属性 WatcherValue\n    this.WatcherValue = this.WatcherGet()\n  }\n  // ! 1、Watcher 和数据关联 -- 通过在Watcher中调用数据实现\n  // 当 Watcher 被调用时 会调用它的成员方法 调用回调\n  update(newValue) {\n    this.cb && this.cb(newValue)\n  }\n  WatcherGet() {\n    // 传送带\n    Dep.target = this\n\n    let value\n    // 要收集的依懒数据\n    const obj = this.vm.proxy_data\n    // 要收集的项\n    value = obj[this.exp]\n    Dep.target = null\n\n    return value\n  }\n}\n\nexport { Watcher }\n","import { observe } from './observer/index'\nimport { Watcher } from './observer/watcher.js'\n\n/**\n * 代理Vue中的数据，通过实例可直接访问 vm.XXX 或 this.XXX\n * @param {*} data 要代理的数据\n */\nfunction _proxy(data) {\n  // 遍历需要代理的数据\n  Object.keys(data).forEach((key) => {\n    // 通过 Object.defineProperty() 方法给每一个数据实现可以通过 vm.XXX 或 this.XXX 可以获取和设置\n    Object.defineProperty(this, key, {\n      get() {\n        console.log('_proxy get => 获取代理')\n        return this.proxy_data[key]\n      },\n      set(value) {\n        console.log('_proxy set => 设置代理')\n        this.proxy_data[key] = value\n      },\n    })\n  })\n}\n\nfunction Vue(options) {\n  // const vm = this\n  this.$options = options\n\n  // 代理options.data  options.data可能是函数，也可能是一个对象\n  this.proxy_data = typeof options.data === 'function' ? options.data() : options.data\n  // 实现数据的响应式（双向绑定） 传入需要实现响应式的数据\n  observe(this.proxy_data)\n  // 代理的方法\n  // ! .call(this, \n  _proxy.call(this, this.proxy_data)\n\n  // this表示Vue的 实例\n  new Watcher(this, 'a', (newValue) => {\n    console.log('a发生改变', newValue)\n  })\n}\n\n// // $watch方法的实现\n// Vue.prototype.$watch = function (key, cb) {\n//   // 实现watch 并执行回调\n//   const vm = this\n//   new Watcher(vm, key, cb)\n// }\n\nexport default Vue\n"],"names":["Dep","constructor","subs","addSubs","watcher","push","console","log","depend","target","notify","newValue","slice","forEach","v","update","defineReactive","obj","key","val","cb","dep","Object","defineProperty","get","set","value","Observer","enumerable","walk","keys","observe","undefined","ob","__ob__","Watcher","vue","exp","vm","WatcherValue","WatcherGet","proxy_data","_proxy","data","Vue","options","$options","call"],"mappings":"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"}